<!DOCTYPE html>

<html lang="en" dir="ltr">
    <%- include('header'); -%>
  <body>
    <%- include('navbar'); -%>
    <div class="form-div">
      <%- include('form_error'); -%>
      <form class="" action="/home/add_accounts" autocomplete="off" method="post">
        <label for="platform_name">Platform :</label><br>
        <input type="text" required name="platform_name" value=""><br>
        <label for="username">Username :</label><br>
        <input type="text" name="username" value=""><br>
        <label for="email">Email :</label><br>
        <input type="text" name="email" value=""><br>
        <label for="password">Password :</label><br>
        <input type="text" required name="password" value=""><br>
        <label for="notes">Notes :</label><br>
        <textarea name="notes" rows="8" cols="50"></textarea><br>
        <button type="submit" name="submit-button">Add</button>
      </form>
      <form class="upload-form" action="/home/upload_csv" enctype="multipart/form-data" method="post">
        <label for="">Upload a csv file :</label>
        <input type="file" id="csv" name="accounts" accept=".csv"><br>
        <button type="button" id="upload" name="button">Upload file</button>
      </form>
    </div>
  </body>
  <script type="text/javascript">

    let csv_data = []

    $('#csv').on('change', function(event){
      let csvInput = event.target;
      let file = csvInput.files[0];
      Papa.parse(file, {
        complete: function(results){
          csv_data = results.data;
          console.log('Completed !');
        }
      })
    })

    $('#upload').on('click', function(){
      if(!csv_data.length)return
      $.post('/home/upload_csv', {csv_data}).done(function(data){
        console.log('The data has been sent to the backend for checking.')
      }).fail(function(e){
        console.log('An error has occured while sending the data to the backend : ', e);
      })

    })
  </script>
</html>
